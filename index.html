<!doctype html>
<html lang="en">
  <head>
    <title>Semantic Libebreaker</title>
    <meta charset="utf-8">
    <style>
      html {
        height: 100%;
      }
      body {
        height: -webkit-calc(100% - 2em);
        height: calc(100% - 2em);
      }
      #textbox {
        height: -webkit-calc(100% - 5em);
        height: calc(100% - 5em);
        width: 90%;
        margin-bottom: 1.5em;
        clear: both;
        line-height: 1.3em;
      }
      form {
        text-align: center;
        width: 100%;
        height: -webkit-calc(100% - 4em);
        height: calc(100% - 4em);
      }
    </style>
    <script>
      function capturePaste() { 
        // http://stackoverflow.com/q/2176861/266309
        setTimeout(breakPhrases, 1);
      }
      function breakPhrases() {
        textarea = document.getElementById("textbox");
        manualMode = document.getElementById("manual-mode");
        // clean up previous runs
        textarea.value = textarea.value.replace(/^(.{0,72})◀/gm, "$1");
        // don't do anything else if we're editing in manual mode
        if(manualMode.checked ) return;
        // break on conjunctions
        textarea.value = textarea.value.replace(/(.{20,}?) (or|and|but|that|e(\. ?)?g\.?|i(\. ?)?e\.?) /g, "$1\n$2 ");
        // break on punctuation
        textarea.value = textarea.value.replace(/(.{20,}?)([,.?!][”"]?|[:;]) /g, "$1$2\n");
        // mark too long lines, if there are any left
        textarea.value = textarea.value.replace(/^([^◀\n]{72,}?)(?!◀) /gm, "$1◀ ");
      }
    </script>
  </head>
  <body>
    <p>
      Paste your text below
      to have it automatically formatted
      using <a href="http://rhodesmill.org/brandon/2012/one-sentence-per-line/">
      semantic linebreaks</a>:
    </p>
    <form>
      <textarea id="textbox" onpaste='capturePaste();' onkeyup='breakPhrases();' autofocus></textarea>
      <br>
      <input type="reset" value="clear">
      <input id="manual-mode" type="checkbox" value="manual">
      <label for="manual-mode">Manual mode</label>  
    </form>
  </body>
</html>
